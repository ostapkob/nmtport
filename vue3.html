{% extends "base.html" %}
{% block main %}
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<div id="app">
    <p class="date-shift"> дата: <strong>{{ '{{date_shift }}' }} </strong>смена: <strong>{{ '{{shift}}' }} </strong> </p>
    <div scope="row" v-for="el in all_data">
        <div class="name-mech">  {{ '   {{ el.name }}  '}}   
        <span class="badge badge-secondary">  {{ '   {{ el.total }}  '}} </span></div>
        <div class="progress">
            <div v-for="minute in el.data" class="progress-bar" role="progressbar"
                style="width: 0.14%"   :class="{ 'bg-warning':minute.value==0, 'bg-danger':minute.value==-1}"></div>
        </div>
        <div class="d-flex justify-content-between line-mech">
            <span class="text-center time-mech" v-for="hour in hs"> {{ '{{ hour }} '}} </span>
        </div>
    </div>
        
</div>


<script type="text/JavaScript"> 
  var jshttp = '{{http}}';
 </script>

<script>
var app = new Vue({
  el: '#app',
  data: {
    timestamp: "",
    counter: 4,
    test: true,
    all_data: [],
    http : jshttp,
    api : '',
    shift: '',
    date_shift: '',
    hs:[],
  },



    methods: {
        hight() {
        this.counter++;
        console.log(this.status);
        },
        getData() {
            axios.get(this.api).then((response) => {
            console.log(response.data);
            this.all_data=response.data;
            });
        },
        getNow: function() {
            let hour;
            const today = new Date();
            hour=today.getHours();
            if (hour>=8 && hour<20) {
                this.date_shift= today.getDate()+'.'+(today.getMonth()+1)+'.'+today.getFullYear();
                this.shift=1;
            }
            else if (hour<8) {
                this.date_shift= (today.getDate()-1)+'.'+(today.getMonth()+1)+'.'+today.getFullYear();
                this.shift=2;
            }
            else {
                this.date_shift= today.getDate()+'.'+(today.getMonth()+1)+'.'+today.getFullYear();
                this.shift=2
            }
            this.api='http://127.0.0.1:5000/api/v1.0/get_data/usm/'+this.date_shift+'/'+this.shift
            this.api='http://35.241.126.216/api/v1.0/get_data/usm/'+this.date_shift+'/'+this.shift
            if (this.shift==1) {
                this.hs = ["08", "'", "'", "╵", "'","'","09", "'", "'", "╵", "'","'","10", "'", "'", "╵", "'","'","11", "'", "'", "╵", "'","'","12", "'", "'", "╵", "'","'","13", "'", "'", "╵", "'","'","14", "'", "'", "╵", "'","'","15", "'", "'", "╵", "'","'","16", "'", "'", "╵", "'","'","17", "'", "'", "╵", "'","'","18", "'", "'", "╵", "'","'","19", "'", "'", "╵", "'","'", " "] }
            else {
                this.hs = ["20", "'", "'", "╵", "'","'","21", "'", "'", "╵", "'","'","22", "'", "'", "╵", "'","'","23", "'", "'", "╵", "'","'","00", "'", "'", "╵", "'","'","01", "'", "'", "╵", "'","'","02", "'", "'", "╵", "'","'","03", "'", "'", "╵", "'","'","04", "'", "'", "╵", "'","'","05", "'", "'", "╵", "'","'","06", "'", "'", "╵", "'","'","07", "'", "'", "╵", "'","'", "08"] }
            },
    },
mounted: function () {
        this.$nextTick(function () {
            window.setInterval(() => {
                this.getNow();
                this.getData();
            },10000);
        })
    },

created: function () {
    this.getNow();
    this.getData();
},
})



</script>

{% endblock %}
